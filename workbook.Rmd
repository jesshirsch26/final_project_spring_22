---
title: "Untitled"
author: "Jessica Hirsch"
date: '2022-05-02'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(here)
library(janitor)

source(here::here("functions.R"))
```

```{r}
goodreads <- 
  read_csv(here::here("Data", "books_updated.csv")) %>% 
  mutate(type = "general")

user_jmh <- 
  read_csv(here::here("Data", "JMHbooks.csv")) %>% 
  mutate(type = "JMH")

awards <- 
  read_csv(here::here("Data", "GoodReadsAwards.csv"))

```

```{r}
glimpse(goodreads)

```

```{r}
goodreads <- 
goodreads %>% 
  select(- best_book_id, -original_title, - starts_with("work"), -small_image_url, -toread_count, -currently_reading)

goodreads <- 
goodreads %>% 
rename("publications" = books_count,
       "publication_year" = original_publication_year)

goodreads <- 
goodreads %>% 
  mutate(language_code = case_when(
    str_detect(language_code, pattern = "^[en]") ~ "en",
    TRUE ~ language_code)) 

```


```{r}
summary(awards)

awards %>% 
  filter(is.na(pages)) %>% 
  select(category, rank, year, title) %>% 
  arrange(desc(rank))

awards <- 
awards %>% 
  select(gid, rank, votes, category, year, pages, published) %>% 
  rename("award_rank" = rank,
         "award_votes" = votes,
         "award_category" = category,
         "award_year" = year,
         "date_published" = published)

```

```{r}

goodreads_awards <- 
goodreads %>% 
  left_join(awards, by = c("book_id" = "gid"))

goodreads_awards %>% 
  summarise(across(everything (), ~sum(is.na(.))))

```

```{r}
user_jmh <- 
clean_names(user_jmh)

glimpse(user_jmh)

user_jmh <- 
user_jmh %>% 
  mutate(date_read = as.Date(date_read, "%d/%m/%Y"),
         date_added = as.Date(date_added, "%d/%m/%Y")) %>% 
  select(-author_l_f, -year_published, -bookshelves_with_positions) %>%
  rename("format" = binding)  


```

```{r}

jmh_look <- 
user_jmh %>% 
  map_dfr(look, .id = "field")

ga_look <- 
goodreads_awards %>% 
  map_dfr(look, .id = "field")

```

```{r}

ga_nums <- 
ga_look %>% 
  filter(class %in% c("numeric", "date")) %>% 
  pull(field)

map(ga_nums, ~ create_hist(goodreads_awards, .x))

```

```{r}
ga_nums_selected
ga_look %>% 
  filter(class %in% c("numeric", "date"),
        !(field %in% c("id", "book_id", "isbn13", (str_remove_all(field, "._\\d"))))) %>% 
  pull(field)

ga_nums

ga_nums_combos <-
expand_grid(field_1 = ga_nums,
            field_2 = ga_nums) %>% 
  filter(field_1 != field_2)

map2(ga_nums_combos$field_1,
     ga_nums_combos$field_2,
     ~ create_scatter(goodreads_awards, .x, .y))
  
```

